{"ast":null,"code":"import jwtParse from \"jwt-decode\";\nimport config from \"./configServer.json\";\nexport const authentication = async (url, content) => {\n  const r = await fetch(url, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json;charset=utf-8\"\n    },\n    body: JSON.stringify(content)\n  });\n  const json = await r.json();\n  return createUserWithAuth(json);\n};\nexport const getCategories = async () => {\n  const r = await fetchWithToken(config.endPoint + \"/category\", {\n    method: \"GET\"\n  });\n  return r.json();\n};\nexport const getProducts = async () => {\n  const r = await fetchWithToken(config.endPoint + \"/product\", {\n    method: \"GET\",\n    headers: {}\n  });\n  return r.json();\n};\nexport const deleteProduct = async url => {\n  try {\n    const r = await fetch(url, {\n      method: \"DELETE\"\n    });\n\n    if (!r.ok) {\n      const message = \"Error with Status Code: \" + r.status;\n      throw new Error(message);\n    }\n\n    const data = await r.json();\n    return data;\n  } catch (error) {\n    console.log(\"Error: \" + error);\n  }\n};\n\nconst fetchWithToken = (url, options) => {\n  const token = localStorage.getItem(\"token\");\n\n  if (token === null) {\n    throw new Error(\"Unauthorized\");\n  }\n\n  const {\n    headers = {},\n    ...restOfOptions\n  } = options || {};\n  return fetch(url, {\n    headers: {\n      Authorization: `Bearer ${token}`,\n      ...headers\n    },\n    ...restOfOptions\n  });\n};\n\nconst createUserWithAuth = data => {\n  const jwtData = jwtParse(data.refreshToken);\n  const user = {\n    email: jwtData.email,\n    name: jwtData.name,\n    isAdmin: jwtData.isAdmin\n  };\n  localStorage.setItem(\"token\", data.refreshToken);\n  return user;\n};","map":{"version":3,"sources":["D:/VSCODE/diplom/client/src/apiProvider.ts"],"names":["jwtParse","config","authentication","url","content","r","fetch","method","headers","body","JSON","stringify","json","createUserWithAuth","getCategories","fetchWithToken","endPoint","getProducts","deleteProduct","ok","message","status","Error","data","error","console","log","options","token","localStorage","getItem","restOfOptions","Authorization","jwtData","refreshToken","user","email","name","isAdmin","setItem"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,YAArB;AAEA,OAAOC,MAAP,MAAmB,qBAAnB;AAUA,OAAO,MAAMC,cAAc,GAAG,OAC5BC,GAD4B,EAE5BC,OAF4B,KAGT;AACnB,QAAMC,CAAC,GAAG,MAAMC,KAAK,CAACH,GAAD,EAAM;AACzBI,IAAAA,MAAM,EAAE,MADiB;AAEzBC,IAAAA,OAAO,EAAE;AACP,sBAAgB;AADT,KAFgB;AAKzBC,IAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeP,OAAf;AALmB,GAAN,CAArB;AAOA,QAAMQ,IAAI,GAAG,MAAMP,CAAC,CAACO,IAAF,EAAnB;AAEA,SAAOC,kBAAkB,CAACD,IAAD,CAAzB;AACD,CAdM;AAgBP,OAAO,MAAME,aAAa,GAAG,YAAkC;AAC7D,QAAMT,CAAC,GAAG,MAAMU,cAAc,CAACd,MAAM,CAACe,QAAP,GAAkB,WAAnB,EAAgC;AAC5DT,IAAAA,MAAM,EAAE;AADoD,GAAhC,CAA9B;AAGA,SAAOF,CAAC,CAACO,IAAF,EAAP;AACD,CALM;AAOP,OAAO,MAAMK,WAAW,GAAG,YAAiC;AAC1D,QAAMZ,CAAC,GAAG,MAAMU,cAAc,CAACd,MAAM,CAACe,QAAP,GAAkB,UAAnB,EAA+B;AAC3DT,IAAAA,MAAM,EAAE,KADmD;AAE3DC,IAAAA,OAAO,EAAE;AAFkD,GAA/B,CAA9B;AAIA,SAAOH,CAAC,CAACO,IAAF,EAAP;AACD,CANM;AAQP,OAAO,MAAMM,aAAa,GAAG,MAAOf,GAAP,IAAuB;AAClD,MAAI;AACF,UAAME,CAAC,GAAG,MAAMC,KAAK,CAACH,GAAD,EAAM;AACzBI,MAAAA,MAAM,EAAE;AADiB,KAAN,CAArB;;AAGA,QAAI,CAACF,CAAC,CAACc,EAAP,EAAW;AACT,YAAMC,OAAO,GAAG,6BAA6Bf,CAAC,CAACgB,MAA/C;AACA,YAAM,IAAIC,KAAJ,CAAUF,OAAV,CAAN;AACD;;AACD,UAAMG,IAAI,GAAG,MAAMlB,CAAC,CAACO,IAAF,EAAnB;AACA,WAAOW,IAAP;AACD,GAVD,CAUE,OAAOC,KAAP,EAAc;AACdC,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAYF,KAAxB;AACD;AACF,CAdM;;AAgBP,MAAMT,cAAc,GAAG,CAACZ,GAAD,EAAcwB,OAAd,KAAoD;AACzE,QAAMC,KAAK,GAAGC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAd;;AACA,MAAIF,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAM,IAAIN,KAAJ,CAAU,cAAV,CAAN;AACD;;AACD,QAAM;AAAEd,IAAAA,OAAO,GAAG,EAAZ;AAAgB,OAAGuB;AAAnB,MAAqCJ,OAAO,IAAI,EAAtD;AAEA,SAAOrB,KAAK,CAACH,GAAD,EAAM;AAChBK,IAAAA,OAAO,EAAE;AACPwB,MAAAA,aAAa,EAAG,UAASJ,KAAM,EADxB;AAEP,SAAGpB;AAFI,KADO;AAKhB,OAAGuB;AALa,GAAN,CAAZ;AAOD,CAdD;;AAgBA,MAAMlB,kBAAkB,GAAIU,IAAD,IAA2B;AACpD,QAAMU,OAAc,GAAGjC,QAAQ,CAACuB,IAAI,CAACW,YAAN,CAA/B;AACA,QAAMC,IAAI,GAAG;AACXC,IAAAA,KAAK,EAAEH,OAAO,CAACG,KADJ;AAEXC,IAAAA,IAAI,EAAEJ,OAAO,CAACI,IAFH;AAGXC,IAAAA,OAAO,EAAEL,OAAO,CAACK;AAHN,GAAb;AAKAT,EAAAA,YAAY,CAACU,OAAb,CAAqB,OAArB,EAA8BhB,IAAI,CAACW,YAAnC;AAEA,SAAOC,IAAP;AACD,CAVD","sourcesContent":["import jwtParse from \"jwt-decode\";\r\nimport { stringify } from \"querystring\";\r\nimport config from \"./configServer.json\";\r\nimport {\r\n  ICategory,\r\n  ILoginData,\r\n  IProduct,\r\n  IRegisterData,\r\n  IUser,\r\n  UserData,\r\n} from \"./types\";\r\n\r\nexport const authentication = async (\r\n  url: string,\r\n  content: IRegisterData | ILoginData\r\n): Promise<IUser> => {\r\n  const r = await fetch(url, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json;charset=utf-8\",\r\n    },\r\n    body: JSON.stringify(content),\r\n  });\r\n  const json = await r.json();\r\n\r\n  return createUserWithAuth(json);\r\n};\r\n\r\nexport const getCategories = async (): Promise<ICategory[]> => {\r\n  const r = await fetchWithToken(config.endPoint + \"/category\", {\r\n    method: \"GET\",\r\n  });\r\n  return r.json();\r\n};\r\n\r\nexport const getProducts = async (): Promise<IProduct[]> => {\r\n  const r = await fetchWithToken(config.endPoint + \"/product\", {\r\n    method: \"GET\",\r\n    headers: {},\r\n  });\r\n  return r.json();\r\n};\r\n\r\nexport const deleteProduct = async (url: string) => {\r\n  try {\r\n    const r = await fetch(url, {\r\n      method: \"DELETE\",\r\n    });\r\n    if (!r.ok) {\r\n      const message = \"Error with Status Code: \" + r.status;\r\n      throw new Error(message);\r\n    }\r\n    const data = await r.json();\r\n    return data\r\n  } catch (error) {\r\n    console.log(\"Error: \" + error);\r\n  }\r\n};\r\n\r\nconst fetchWithToken = (url: string, options?: RequestInit | undefined) => {\r\n  const token = localStorage.getItem(\"token\");\r\n  if (token === null) {\r\n    throw new Error(\"Unauthorized\");\r\n  }\r\n  const { headers = {}, ...restOfOptions } = options || {};\r\n\r\n  return fetch(url, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n      ...headers,\r\n    },\r\n    ...restOfOptions,\r\n  });\r\n};\r\n\r\nconst createUserWithAuth = (data: UserData): IUser => {\r\n  const jwtData: IUser = jwtParse(data.refreshToken);\r\n  const user = {\r\n    email: jwtData.email,\r\n    name: jwtData.name,\r\n    isAdmin: jwtData.isAdmin,\r\n  };\r\n  localStorage.setItem(\"token\", data.refreshToken);\r\n\r\n  return user;\r\n};\r\n"]},"metadata":{},"sourceType":"module"}